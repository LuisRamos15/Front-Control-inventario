<div class="users-wrapper">
  <div class="users-header">
    <div class="title">
      <h2>Gestión de Usuarios</h2>
      <p>Administra roles, estado y conexión.</p>
    </div>
    <div class="search-box">
      <input
        type="text"
        class="search-input"
        placeholder="Buscar por nombre o rol"
        [(ngModel)]="filtro"
      />
      <span class="search-icon"></span>
    </div>
  </div>
  <div class="card">
    <div class="users-table">
      <div class="users-header">
        <div class="col col-usuario">Usuario</div>
        <div class="col col-rol">Rol</div>
        <div class="col col-activo">Activo</div>
        <div class="col col-acciones">Acciones</div>
      </div>
      <div class="users-row" *ngFor="let u of filtrar()">
        <div class="col col-usuario">
          <div class="user-id">
            <span class="avatar">{{ u.nombreUsuario?.charAt(0) | uppercase }}</span>
            <div class="name-mail">
              <div class="name">{{ u.nombreUsuario }}</div>
              <div class="sub" *ngIf="u.email">{{ u.email }}</div>
            </div>
          </div>
        </div>
        <div class="col col-rol">
          <span class="pill"
            [ngClass]="{'pill--admin': hasRole(u,'ADMIN'),
            'pill--super': hasRole(u,'SUPERVISOR'),
            'pill--op': hasRole(u,'OPERADOR')}">
            {{ displayRol(u) }}
          </span>
        </div>
        <div class="col col-activo">
          <span class="flag" [class.flag--ok]="u.activo" [class.flag--off]="!u.activo">
            {{ u.activo ? 'Sí' : 'No' }}
          </span>
        </div>
        <div class="col col-acciones">
          <button type="button" class="btn-ghost" (click)="onEdit(u)" aria-label="Editar usuario">
            <i class="ri-pencil-line"></i>
          </button>
          <button type="button" class="btn-ghost btn-danger" (click)="onDelete(u)" aria-label="Eliminar usuario">
            <i class="ri-delete-bin-6-line"></i>
          </button>
        </div>
      </div>
      <div *ngIf="filtrar().length===0" class="empty">Sin resultados para {{filtro}}.</div>
    </div>
  </div>

   <!-- Overlay -->
   <div class="u-modal-backdrop" *ngIf="editOpen" (click)="closeEdit()"></div>
   <!-- Panel centrado -->
   <div class="u-modal" *ngIf="editOpen" role="dialog" aria-modal="true" aria-label="Editar Usuario">
     <div class="u-modal__hdr">
       <h3>Editar Usuario</h3>
       <button class="u-close" (click)="closeEdit()" aria-label="Cerrar"></button>
     </div>
     <div class="u-modal__body">
       <div class="u-field">
         <label>Nombre de Usuario</label>
         <input class="u-input"
           type="text"
           [(ngModel)]="editForm.nombreUsuario"
           maxlength="60" />
       </div>
       <div class="u-field">
         <label>Rol</label>
         <select class="u-input"
           [(ngModel)]="editForm.rol">
           <option value="ADMIN">ADMIN</option>
           <option value="SUPERVISOR">SUPERVISOR</option>
           <option value="OPERADOR">OPERADOR</option>
         </select>
       </div>
     </div>
     <div class="u-modal__ftr">
       <button class="u-btn u-btn-ghost" (click)="closeEdit()">Cancelar</button>
       <button class="u-btn u-btn-primary" (click)="saveEdit()" [disabled]="saving || !isEditValid()">
         Guardar
       </button>
     </div>
   </div>

    <!-- éxito centrado -->
    <div class="u-success-backdrop" *ngIf="successOpen"></div>
    <div class="u-success" *ngIf="successOpen" role="alert" aria-live="assertive">
      <div class="u-success__icon"></div>
      <div class="u-success__text">Usuario editado exitosamente</div>
    </div>
</div>