<div class="page-header d-flex justify-between align-center">
  <h1 class="page-title">Reportes</h1>
  <div class="actions d-flex gap-8">
    <button class="btn btn-outline" (click)="onExportarExcel()" [disabled]="cargando">
      <i class="bi bi-file-earmark-excel"></i> Exportar Excel
    </button>
    <div class="dropdown" style="display:inline-block">
      <button class="btn btn-outline">
        <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
      </button>
      <div class="dropdown-menu">
        <button class="dropdown-item" (click)="onExportarPdfInventario()">Inventario</button>
        <button class="dropdown-item" (click)="onExportarPdfMovimientos()">Movimientos</button>
      </div>
    </div>
    <button class="btn btn-primary" (click)="onImprimir()">
      <i class="bi bi-printer"></i> Imprimir
    </button>
  </div>
</div>

<div id="printArea" class="mt-24">
  <h2>Resumen de Inventario</h2>
  <div class="cards">
     <div class="card">
       <h3>Total Productos</h3>
       <h2>{{ totalProductos }}</h2>
       <p class="muted">Activos en stock</p>
     </div>
     <div class="card">
       <h3>Valor Total</h3>
       <h2>${{ valorTotal | number:'1.0-0' }}</h2>
       <p class="muted">Estimado</p>
     </div>
     <div class="card">
       <h3>Productos Bajos</h3>
       <h2>{{ productosBajos }}</h2>
       <p class="muted">Necesitan reposición</p>
     </div>
     <div class="card">
       <h3>Categorías</h3>
       <h2>{{ categorias }}</h2>
       <p class="muted">Activas</p>
     </div>
  </div>

   <div class="mt-24">
     <h3>Gráfico de Tendencias</h3>
     <div class="chart-placeholder" style="height:300px; background:#f8f9fa; border:1px dashed #dee2e6; display:flex; align-items:center; justify-content:center; border-radius:8px;">
       <canvas #trendCanvas aria-label="Tendencias Entradas/Salidas"></canvas>
     </div>
   </div>
</div>

<div id="printArea">
  <!-- Bloque de estadísticas, igual a la maqueta -->
  <section class="grid-2 gap-16 mt-16">
    <div class="card p-16">
      <h2 class="section-title">Estadísticas de Consumo</h2>
       <div class="chart-placeholder">
         <canvas #consumoCanvas aria-label="Top 5 Salidas"></canvas>
       </div>
        <div class="top5 mt-16">
          <strong>Top 5 Productos Más Vendidos:</strong>
          <div *ngIf="loadingTop" class="text-gray-500 mt-1">Cargando</div>
          <ul *ngIf="!loadingTop" class="list-decimal ml-4 mt-1">
            <li *ngFor="let p of topProductos; index as i">
              {{ p.nombre || 'Producto' }}
              <span class="text-gray-500">({{ p.cantidad | number:'1.0-0' }} unidades)</span>
            </li>
            <li *ngIf="topProductos.length === 0" class="text-gray-500 list-none ml-0">Sin datos para el periodo.</li>
          </ul>
        </div>
    </div>

    <div class="card p-16">
      <h2 class="section-title">Rotación de Productos</h2>
       <div class="chart-placeholder">
         <canvas #rotacionCanvas aria-label="Rotación (salidas + media móvil)"></canvas>
       </div>
      <div class="kpis mt-16 d-flex gap-24">
        <div>
          <div class="kpi-number">4.2</div>
          <div class="muted">Rotaciones/Mes</div>
        </div>
        <div>
          <div class="kpi-number">7.1</div>
          <div class="muted">Días Promedio</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Resumen general en cards como la maqueta -->
  <section class="cards">
    <div class="card">
      <div class="muted">TOTAL INVENTARIO</div>
      <h2>$125,430.50</h2>
    </div>
    <div class="card">
      <div class="muted">VALOR VENDIDO (30 días)</div>
      <h2 class="ok">$45,230.00</h2>
    </div>
    <div class="card">
      <div class="muted">VALOR EN STOCK BAJO</div>
      <h2 class="warning">$3,450.00</h2>
    </div>
    <div class="card">
      <div class="muted">PRODUCTOS SIN MOVIMIENTO</div>
      <h2>23</h2>
    </div>
  </section>
</div>