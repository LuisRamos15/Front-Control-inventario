<section class="encabezado">

<h2>Registro de Movimientos</h2>

<button class="btn btn-primary" (click)="openNuevoMovimiento()">+ Nuevo Movimiento</button>

</section>

<nav class="tabs">

<button type="button" (click)="seleccionarTab('TODOS')"   [class.active]="activeTab==='TODOS'">Todos</button>

<button type="button" (click)="seleccionarTab('ENTRADA')" [class.active]="activeTab==='ENTRADA'">Entradas</button>

<button type="button" (click)="seleccionarTab('SALIDA')"  [class.active]="activeTab==='SALIDA'">Salidas</button>

</nav>

<div class="tabla-wrapper">

<table mat-table [dataSource]="filas" class="tabla">

<ng-container matColumnDef="fecha">
  <th mat-header-cell *matHeaderCellDef>Fecha/Hora</th>
  <td mat-cell *matCellDef="let m">{{ m.fecha | date:'yyyy-MM-dd HH:mm' }}</td>
</ng-container>

<ng-container matColumnDef="tipo">
  <th mat-header-cell *matHeaderCellDef>Tipo</th>
  <td mat-cell *matCellDef="let m" [class.entrada]="m.tipo==='ENTRADA'" [class.salida]="m.tipo==='SALIDA'">
    {{ m.tipo }}
  </td>
</ng-container>

<ng-container matColumnDef="producto">
  <th mat-header-cell *matHeaderCellDef>Producto</th>
  <td mat-cell *matCellDef="let m" class="prod-cell">
    <span class="prod-name">{{ m.productoNombre }}</span>
    <small class="sku-chip">({{ m.sku }})</small>
  </td>
</ng-container>

<ng-container matColumnDef="cantidad">
  <th mat-header-cell *matHeaderCellDef>Cantidad</th>
  <td mat-cell *matCellDef="let m" [class.pos]="m.tipo==='ENTRADA'" [class.neg]="m.tipo==='SALIDA'">
    {{ m.tipo==='ENTRADA' ? '+' : '-' }}{{ m.cantidad }}
  </td>
</ng-container>

<ng-container matColumnDef="usuario">
  <th mat-header-cell *matHeaderCellDef>Usuario</th>
  <td mat-cell *matCellDef="let m">{{ m.usuario }}</td>
</ng-container>

<ng-container matColumnDef="motivo">
  <th mat-header-cell *matHeaderCellDef>Motivo</th>
  <td mat-cell *matCellDef="let m">{{ motivoOf(m) }}</td>
</ng-container>

<ng-container matColumnDef="notas">
  <th mat-header-cell *matHeaderCellDef>Notas</th>
  <td mat-cell *matCellDef="let m"></td>
</ng-container>

<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

<tr *matNoDataRow>
  <td colspan="7" class="muted">Sin registros.</td>
</tr>

</table>

</div>

<div class="paginator-row">

<span class="mr-2">Items per page:</span>

<!-- Paginador material (5/10/20) controlado por backend -->

<mat-paginator

[length]="total"

[pageIndex]="pageIndex"

[pageSize]="mostrarTodo ? total : pageSize"

[pageSizeOptions]="pageSizeOpts"

[showFirstLastButtons]="true"

(page)="onPage($event)">

</mat-paginator>

<!-- BotÃ³n 'Todo' (no cambia estilos globales) -->

<button type="button"

class="btn btn-link ml-2"

(click)="verTodo()"

[disabled]="mostrarTodo || total <= pageSize">

Todo

</button>

</div>

<app-movimiento-modal

*ngIf="showNuevoModal"

(close)="closeNuevoMovimiento()"

(saved)="onMovimientoGuardado($event)">

</app-movimiento-modal>
